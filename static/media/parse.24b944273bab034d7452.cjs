"use strict";Object.defineProperty(exports,"longFormatters",{enumerable:!0,get:function(){return _index2.longFormatters}}),exports.parse=parse,Object.defineProperty(exports,"parsers",{enumerable:!0,get:function(){return _index7.parsers}});var _index=require("./_lib/defaultLocale.cjs"),_index2=require("./_lib/format/longFormatters.cjs"),_index3=require("./_lib/protectedTokens.cjs"),_index4=require("./constructFrom.cjs"),_index5=require("./getDefaultOptions.cjs"),_index6=require("./toDate.cjs"),_Setter=require("./parse/_lib/Setter.cjs"),_index7=require("./parse/_lib/parsers.cjs");const formattingTokensRegExp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp=/^'([^]*?)'?$/,doubleQuoteRegExp=/''/g,notWhitespaceRegExp=/\S/,unescapedLatinCharacterRegExp=/[a-zA-Z]/;function parse(e,t,r,n){const o=()=>(0,_index4.constructFrom)(n?.in||r,NaN),i=(0,_index5.getDefaultOptions)(),a=n?.locale??i.locale??_index.defaultLocale,s=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,c=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0;if(!t)return e?o():(0,_index6.toDate)(r,n?.in);const l={firstWeekContainsDate:s,weekStartsOn:c,locale:a},p=[new _Setter.DateTimezoneSetter(n?.in,r)],u=t.match(longFormattingTokensRegExp).map((e=>{const t=e[0];if(t in _index2.longFormatters){return(0,_index2.longFormatters[t])(e,a.formatLong)}return e})).join("").match(formattingTokensRegExp),d=[];for(let m of u){!n?.useAdditionalWeekYearTokens&&(0,_index3.isProtectedWeekYearToken)(m)&&(0,_index3.warnOrThrowProtectedError)(m,t,e),!n?.useAdditionalDayOfYearTokens&&(0,_index3.isProtectedDayOfYearToken)(m)&&(0,_index3.warnOrThrowProtectedError)(m,t,e);const r=m[0],i=_index7.parsers[r];if(i){const{incompatibleTokens:t}=i;if(Array.isArray(t)){const e=d.find((e=>t.includes(e.token)||e.token===r));if(e)throw new RangeError(`The format string mustn't contain \`${e.fullToken}\` and \`${m}\` at the same time`)}else if("*"===i.incompatibleTokens&&d.length>0)throw new RangeError(`The format string mustn't contain \`${m}\` and any other token at the same time`);d.push({token:r,fullToken:m});const n=i.run(e,m,a.match,l);if(!n)return o();p.push(n.setter),e=n.rest}else{if(r.match(unescapedLatinCharacterRegExp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+r+"`");if("''"===m?m="'":"'"===r&&(m=cleanEscapedString(m)),0!==e.indexOf(m))return o();e=e.slice(m.length)}}if(e.length>0&&notWhitespaceRegExp.test(e))return o();const f=p.map((e=>e.priority)).sort(((e,t)=>t-e)).filter(((e,t,r)=>r.indexOf(e)===t)).map((e=>p.filter((t=>t.priority===e)).sort(((e,t)=>t.subPriority-e.subPriority)))).map((e=>e[0]));let g=(0,_index6.toDate)(r,n?.in);if(isNaN(+g))return o();const x={};for(const m of f){if(!m.validate(g,l))return o();const e=m.set(g,x,l);Array.isArray(e)?(g=e[0],Object.assign(x,e[1])):g=e}return g}function cleanEscapedString(e){return e.match(escapedStringRegExp)[1].replace(doubleQuoteRegExp,"'")}