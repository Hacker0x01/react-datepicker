"use strict";exports.parseISO=parseISO;var _index=require("./constants.cjs"),_index2=require("./constructFrom.cjs"),_index3=require("./toDate.cjs");function parseISO(e,t){const n=()=>(0,_index2.constructFrom)(t?.in,NaN),a=t?.additionalDigits??2,i=splitDateString(e);let r;if(i.date){const e=parseYear(i.date,a);r=parseDate(e.restDateString,e.year)}if(!r||isNaN(+r))return n();const s=+r;let o,u=0;if(i.time&&(u=parseTime(i.time),isNaN(u)))return n();if(!i.timezone){const e=new Date(s+u),n=(0,_index3.toDate)(0,t?.in);return n.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),n.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),n}return o=parseTimezone(i.timezone),isNaN(o)?n():(0,_index3.toDate)(s+u+o,t?.in)}const patterns={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},dateRegex=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,timeRegex=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,timezoneRegex=/^([+-])(\d{2})(?::?(\d{2}))?$/;function splitDateString(e){const t={},n=e.split(patterns.dateTimeDelimiter);let a;if(n.length>2)return t;if(/:/.test(n[0])?a=n[0]:(t.date=n[0],a=n[1],patterns.timeZoneDelimiter.test(t.date)&&(t.date=e.split(patterns.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){const e=patterns.timezone.exec(a);e?(t.time=a.replace(e[1],""),t.timezone=e[1]):t.time=a}return t}function parseYear(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(n);if(!a)return{year:NaN,restDateString:""};const i=a[1]?parseInt(a[1]):null,r=a[2]?parseInt(a[2]):null;return{year:null===r?i:100*r,restDateString:e.slice((a[1]||a[2]).length)}}function parseDate(e,t){if(null===t)return new Date(NaN);const n=e.match(dateRegex);if(!n)return new Date(NaN);const a=!!n[4],i=parseDateUnit(n[1]),r=parseDateUnit(n[2])-1,s=parseDateUnit(n[3]),o=parseDateUnit(n[4]),u=parseDateUnit(n[5])-1;if(a)return validateWeekDate(t,o,u)?dayOfISOWeekYear(t,o,u):new Date(NaN);{const e=new Date(0);return validateDate(t,r,s)&&validateDayOfYearDate(t,i)?(e.setUTCFullYear(t,r,Math.max(i,s)),e):new Date(NaN)}}function parseDateUnit(e){return e?parseInt(e):1}function parseTime(e){const t=e.match(timeRegex);if(!t)return NaN;const n=parseTimeUnit(t[1]),a=parseTimeUnit(t[2]),i=parseTimeUnit(t[3]);return validateTime(n,a,i)?n*_index.millisecondsInHour+a*_index.millisecondsInMinute+1e3*i:NaN}function parseTimeUnit(e){return e&&parseFloat(e.replace(",","."))||0}function parseTimezone(e){if("Z"===e)return 0;const t=e.match(timezoneRegex);if(!t)return 0;const n="+"===t[1]?-1:1,a=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return validateTimezone(a,i)?n*(a*_index.millisecondsInHour+i*_index.millisecondsInMinute):NaN}function dayOfISOWeekYear(e,t,n){const a=new Date(0);a.setUTCFullYear(e,0,4);const i=7*(t-1)+n+1-(a.getUTCDay()||7);return a.setUTCDate(a.getUTCDate()+i),a}const daysInMonths=[31,null,31,30,31,30,31,31,30,31,30,31];function isLeapYearIndex(e){return e%400===0||e%4===0&&e%100!==0}function validateDate(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(daysInMonths[t]||(isLeapYearIndex(e)?29:28))}function validateDayOfYearDate(e,t){return t>=1&&t<=(isLeapYearIndex(e)?366:365)}function validateWeekDate(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function validateTime(e,t,n){return 24===e?0===t&&0===n:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function validateTimezone(e,t){return t>=0&&t<=59}